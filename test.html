<html>

<head>
  <meta charset="" utf-8">
</head>
<button id="run">Run</button>
<script src="third_party/encoding.js"></script>
<script type="module">
  import { FatFs } from "./fs/fat_fs.js"
  import { NativeFs } from "./fs/native_fs.js"
  import { XdfImage } from "./image/xdf_image.js"
  import { NativeIo } from "./io/native_io.js"

  const io = new NativeIo();
  //const out = new NativeIo();
  document.getElementById('run').addEventListener('click', async e => {
    await io.choose();
    //await out.choose();
    const xdf = new XdfImage();
    await xdf.open(io);
    const fat = new FatFs();
    await fat.open(xdf);
    console.log(await fat.getAttributes());
    await fat.list(entry => {
      console.log(entry);
    });
    /*
    await fat.chdir('SYS');
    console.log(await fat.getCwd());
    await fat.list(entry => {
      console.log(entry);
    });
    await fat.chdir('..');
    console.log(await fat.getCwd());
    await fat.list(entry => {
      console.log(entry);
    });
    */
    const newFile = await fat.getIo('NEW', { create: true });
    newFile.close();
    /*
    const file = await fat.getIo('AUTOEXEC.BAT');
    console.log(file);
    while (true) {
      const data = await file.read(1024);
      console.log(data.byteLength);
      if (data.byteLength == 0) {
        break;
      }
      await out.write(data);
    }
    out.close();
    */
  });
</script>

</html>